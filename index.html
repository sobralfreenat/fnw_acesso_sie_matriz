<!doctype html>
<html>
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>GERiAH - Plataforma Corporativa FNW 5.2</title>
    <link href="//www.sie.com.br/css/estilo.css?v33" rel="stylesheet" type="text/css" />
    <link href="//www.sie.com.br/css/fontes/fontface.css" type="text/css" rel="stylesheet"  />
    <!-- Excluído: jquery.fancybox.css -->
    <!-- Excluído: Google Analytics -->

    <style>
        /* Estilos Gerais */
        body {
            font-family: sans-serif; /* Fonte mais padrão */
            text-align: left; /* Garante alinhamento à esquerda para todo o corpo */
        }
        * { box-sizing: border-box; }

        /* Botões Padrão */
        button, input[type="submit"], input[type="button"] {
            cursor: pointer;
            padding: 8px 15px;
            border: 1px solid #ccc;
            border-radius: 4px;
            background-color: #f0f0f0;
            font-size: 0.95em;
            transition: background-color 0.2s ease, border-color 0.2s ease;
        }
        button:hover, input[type="submit"]:hover, input[type="button"]:hover {
            background-color: #e0e0e0;
            border-color: #bbb;
        }
        button:disabled, input[type="submit"]:disabled, input[type="button"]:disabled {
            cursor: not-allowed;
            opacity: 0.6;
        }

        /* Botões Específicos */
        #adminButton {
            background: #fff;
            border: 1px solid #aaa;
            padding: 4px 8px;
        }
        #myCoursesButton {
            background-color: #0c7cac; /* Azul */
            color: white;
            border: none;
            font-weight: bold;
        }
        #myCoursesButton:hover {
            background-color: #0a6991;
        }
        #fetchTrailsButton {
            background-color: #0c7cac; /* Azul */
            color: white;
            border: none;
            font-weight: bold;
        }
        #fetchTrailsButton:hover {
            background-color: #0a6991;
        }
        #closeCoursePlayerButton {
            /* Estilos base definidos aqui */
            background-color: rgba(0,0,0,0.7);
            color: white;
            border: 1px solid white;
            padding: 5px 10px;
            font-size: 0.9em;
            border-radius: 3px;
            z-index: 1001;
        }
        #closeCoursePlayerButton:hover {
            background-color: rgba(0,0,0,0.9);
        }

        /* Seções Principais */
        #myCoursesSection, 
        #adminSection {
            background-color: rgba(255, 255, 255, 0.90); /* MODIFICADO: de 0.95 para 0.90 para mais transparência */
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 20px;
            margin: 20px auto; /* Centralizado com margem superior/inferior */
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            width: 1800px !important; /* Forçando largura 1800px */
            max-width: 95% !important; /* Forçando max-width */
        }
        /* NOVO: Estilos para os botões de Zerar Curso */
        .reset-course-button {
            background-color: #dc3545; /* Vermelho para deletar/zerar */
            color: white;
            border: none;
            padding: 6px 10px;
            font-size: 0.85em;
            border-radius: 3px;
            cursor: pointer;
            margin-left: 10px;
            transition: background-color 0.2s ease;
        }
        .reset-course-button:hover {
            background-color: #c82333;
        }
        .reset-all-courses-button {
            background-color: #ffc107; /* Amarelo para atenção */
            color: black;
            border: none;
            padding: 8px 15px;
            font-size: 0.95em;
            border-radius: 4px;
            cursor: pointer;
            margin-bottom: 20px;
            transition: background-color 0.2s ease;
        }
        .reset-all-courses-button:hover {
            background-color: #e0a800;
        }
        /* NOVO: Estilos para os botões de Ocultar/Limpar Display */
        .hide-course-button {
            background-color: #6c757d; /* Cinza para ocultar */
            color: white;
            border: none;
            padding: 6px 10px;
            font-size: 0.85em;
            border-radius: 3px;
            cursor: pointer;
            margin-left: 5px; /* Espaço entre Zerar e Ocultar */
            transition: background-color 0.2s ease;
        }
        .hide-course-button:hover {
            background-color: #5a6268;
        }
        .clear-display-button {
            background-color: #17a2b8; /* Azul claro para limpar display */
            color: white;
            border: none;
            padding: 8px 15px;
            font-size: 0.95em;
            border-radius: 4px;
            cursor: pointer;
            margin-left: 10px; /* Espaço entre Zerar Todos e Limpar Display */
            transition: background-color 0.2s ease;
        }
        .clear-display-button:hover {
            background-color: #138496;
        }

        /* Largura específica para admin não mais necessária se for 1300px */
        /* #adminSection { width: 900px; } */ 

        #coursePlayerContainer {
            border-radius: 5px;
            overflow: hidden; 
            box-shadow: 0 3px 7px rgba(0,0,0,0.2);
            position: relative; 
            margin: 20px auto; /* Centralizado */
            background-color: #bc880e; /* Fundo preto */
            width: 1800px !important; /* Forçando largura 1800px */
            max-width: 95% !important; /* Forçando max-width */
            height: 1000px; /* Altura ajustada para 1000px */
            padding: 0; /* Player não tem padding interno */
        }

        /* Inputs de Texto */
        .text-input {
            padding: 8px 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-size: 1em;
            margin-bottom: 5px; 
        }

        /* Links */
        a {
            color: #007bff;
            text-decoration: none;
        }
        a:hover {
            text-decoration: underline;
        }

        /* Tarja semitransparente no header para destacar conteúdo */
        #header .in {
            position: fixed !important;
            top: 10px !important;
            left: 0px !important;
            width: 100% !important; /* Changed from 130% to 100% to ensure responsiveness */
            background-color: rgba(71, 71, 71, 0.452) !important;
            backdrop-filter: blur(5px) !important; /* Adjusted blur to 5px */
            -webkit-backdrop-filter: blur(5px) !important; /* Adjusted blur to 5px */
            z-index: 10000 !important;
        }

/* --- Media Query para Telas Pequenas (Mobile - Nova Tentativa) --- */
        @media (max-width: 768px) {
            #header .in {
                position: static !important; /* ALTERADO: Forçar posição estática no mobile */
                padding: 10px;
                background-color: #38464b; /* ADICIONADO: Fundo branco para mobile */
                backdrop-filter: blur(10px);
                -webkit-backdrop-filter: blur(10px);
                border-bottom: 1px solid #ccc;
                overflow: visible; /* Garante que conteúdo não seja cortado */
                /* REMOVIDO: height: 250px !important; */
                /* REMOVIDO: display: block !important; */
                /* REMOVIDO: min-height: 400px !important; */
            }

            #logo {
                margin: 0 auto 15px auto; /* Centraliza e adiciona margem inferior */
                text-align: center;
            }
            #logo img {
                display: inline-block !important; /* Permite centralização com text-align */
                max-height: 35px; /* Mobile: Reduzida altura máxima */
            }

            #login {
                margin-left: 0; /* Remove margem esquerda do desktop */
                width: 100%;    /* Ocupa toda a largura */
            }

            #login-enter {
                display: block; /* Blocos de login um abaixo do outro */
                padding: 0; /* Mobile: REMOVIDO padding lateral novamente */
                display: block !important; /* FORÇAR display block para mobile */
            }

            #login-form, #login-card, #login-instance {
                margin-right: auto; /* Centraliza */
                margin-left: auto; /* Centraliza */
                margin-bottom: 20px; /* Espaço entre blocos */
                width: 100%;
                flex-shrink: initial; /* Reseta o flex-shrink se ainda existir */
                border: none;
                padding: 15px; /* Aumenta o padding interno das caixas de formulário */
				color: lightgray;
                background-color: rgba(59, 32, 74, 0.95); /* Adjusted to darker purple with transparency */
				/* REMOVED: opacity: 0.8; */
                box-sizing: border-box;
                border-radius: 8px; /* Adiciona um leve arredondamento nas bordas das caixas */
                box-shadow: 0 2px 5px rgba(0,0,0,0.2); /* Adiciona uma sombra sutil */
            }

            /* Estilos gerais para elementos internos do login */
            #login label {
                display: block;
                margin-bottom: 5px;
                font-weight: bold;
                text-align: center; /* Mobile: Centralizar labels */
            }
            #login .text-input,
            #login button,
            #login input[type="submit"] {
                width: 100%;
                margin-top: 5px;
                margin-bottom: 10px; /* Aumenta espaço inferior */
                float: none !important; /* Remove floats antigos com prioridade */
                margin-right: 0 !important; /* Remove margem direita de float */
                box-sizing: border-box;
                padding: 8px 12px; /* Mobile: Padding reduzido */
                font-size: 1em;
                background-color: #f8f8f8; /* Fundo um pouco mais claro */
                border: 1px solid #ddd;   /* Borda sutil */
                border-radius: 3px;
                text-align: center; /* Centraliza texto do input/button */
            }
             /* Mobile: Estilo Hover para botões */
            #login button:hover,
            #login input[type="submit"]:hover {
                background-color: #eee;
                border-color: #ccc;
            }

            #login small {
                display: block;
                text-align: center;
                margin-top: 10px; /* Mobile: Aumentada margem superior */
                width: 100%;
                font-size: 0.9em;
            }
            #login br[style*="clear:both"] {
                display: none; /* Esconde quebras de linha de float */
            }

            /* Ajustes específicos para floats remanescentes e flex interno */
            #login-form > form > div {
                width: 100% !important;
                float: none !important;
                margin-right: 0 !important;
                margin-bottom: 15px;
            }
            /* Mobile: Override INLINE styles within #login-form */
            #login-form > form > div[style*="float:left"] {
                width: 100% !important;
                float: none !important;
                margin-right: 0 !important;
                padding-left: 0; /* Garante alinhamento esquerdo */
                margin-bottom: 10px; /* Adicionado para espaçamento vertical */
            }

            /* Esconder o 'Esqueceu a senha?' que fica solto */
            #login-form > form > div > a#senha {
                text-align: center; /* Centraliza */
            }

            /* REFORÇADO: Remove display flex e força empilhamento para Código Acesso e ID Instancia */
            #login-card > form > div,
            #login-instance > div:first-of-type {
                display: block !important;
            }
            /* REFORÇADO: Garante alinhamento e largura interna para Código Acesso e ID Instancia */
            #login-card > form > div > div,
            #login-instance > div:first-of-type > div {
                margin-right: 0 !important;
                margin-bottom: 10px !important;
                width: 100% !important;
                padding-left: 0 !important;
            }
            /* REFORÇADO: Força botão abaixo do input em Código Acesso e ID Instancia */
            #login-card button[type="submit"],
            #login-instance button[type="button"] {
                display: block !important;
                width: 100% !important;
                margin-top: 5px !important;
                float: none !important; /* Garantia extra */
            }

            /* --- Regras específicas para estado LOGADO no Mobile --- */
            body.logged-in {
                /* REMOVIDO: padding-top */
            }

            /* Esconde forms de login quando logado */
            body.logged-in #login-enter {
                display: none !important;
            }

            /* Mostra botões de usuário quando logado */
            body.logged-in #myCoursesButton,
            body.logged-in #adminButton {
                position: static;
                display: block !important; /* Usa !important para garantir override */
                width: calc(100% - 40px); /* Largura com margem */
                margin: 20px auto; /* Centraliza */
                text-align: center;
                float: none;
                padding: 12px;
                font-size: 1.1em;
                /* Herda outros estilos de botão se necessário ou define aqui */
            }

            /* Mostra controles admin FNW SE o e-mail logado for o autorizado */
            /* REMOVIDO: body.logged-in #adminSection { margin-top: 360px; } */

            /* NOVO: Ajuste do margin-top para #adminSection no mobile */
            #adminSection {
                margin-top: 1200px !important; /* Aumentado para 1200px */
            }

            /* NOVO: Ajuste do margin-top para #myCoursesSection no mobile */
            #myCoursesSection {
                margin-top: 1200px !important; /* Aumentado para 1200px */
            }

            /* --- Fim das regras de estado logado --- */

            /* Botões Fixos (Conteúdo/Admin) - REGRA ANTIGA REMOVIDA
            #myCoursesButton, #adminButton {
                position: static;
                display: block;
                width: calc(100% - 40px);
                margin: 20px auto;
                text-align: center;
                float: none;
                padding: 12px;
                font-size: 1.1em;
            }*/

            #gearIcon {
                display: none; /* Esconde ícone engrenagem no mobile */
            }
        }

        /* === ESTILOS PARA MELHORAR LEGIBILIDADE DA LISTA DE CURSOS EM TRILHAS === */
        .trail-item .courses-list h5 { /* Título "Cursos:" */
            font-size: 1.1em; /* Aumenta um pouco o título da seção de cursos */
            margin-bottom: 8px; /* Adiciona mais espaço abaixo do título */
            color: #333; /* Cor escura para bom contraste */
        }

        .trail-item .courses-list ul {
            list-style-type: disc; /* Garante marcadores visíveis, se desejado */
            padding-left: 25px; /* Adiciona um pouco de indentação para os marcadores */
        }

        .trail-item .courses-list .course-item {
            font-size: 1.25em;    /* Aumentado em 25% (de 1em para 1.25em) */
            line-height: 1.6;     /* Aumenta o espaçamento entre as linhas para melhor leitura */
            margin-bottom: 10px;  /* Aumenta o espaço entre os itens da lista de cursos */
            padding: 5px 0;       /* Adiciona um pouco de preenchimento vertical interno */
            color: #222; /* Cor de texto escura para bom contraste */
            text-align: left; /* Garante alinhamento à esquerda para os títulos/itens */
        }

        /* Estilo para aumentar o título da trilha (H4) */
        .trail-item .toggle-details h4 {
            font-size: 1.45em; /* Aumento de aprox. 25% sobre um H4 padrão de ~1.17em */
            /* Você pode ajustar este valor (ex: 1.5em) se quiser um pouco maior ou menor */
            margin: 0; /* Remove margens padrão do H4 para não bagunçar o flex layout */
        }

        /* Efeito de hover para o CABEÇALHO da trilha */
        .trail-item .toggle-details:hover {
            background-color: #e9e9e9; /* Um cinza um pouco diferente para o cabeçalho, ou use #f0f0f0 */
        }

        /* Efeito de hover para itens de curso nas Trilhas */
        .trail-item .courses-list .course-item:hover {
            background-color: #f0f0f0; /* Cor de fundo suave ao passar o mouse */
            /* color: #000; */ /* Opcional: Mudar cor do texto se necessário para contraste */
        }

        /* Efeito de hover para itens em Meus Cursos */
        #myCoursesContainer .course-item:hover {
            background-color: #f0f0f0; /* Mesma cor de fundo suave */
            /* color: #000; */ /* Opcional: Mudar cor do texto */
        }
        /* === FIM DOS ESTILOS DE LEGIBILIDADE === */

        .blurred-background {
            /* REMOVED: filter: blur(8px); */
            /* REMOVED: -webkit-filter: blur(8px); */ /* Para compatibilidade com Safari */
        }

        /* --- Media Query para Telas Médias (Tablets e Desktops Pequenos) --- */
        @media (max-width: 1024px) {
            /* Ajustes para o container principal do header */
            #header .in {
                /* Remover padding e margens fixas que podem causar overflow em larguras maiores */
                padding-left: 10px !important;
                padding-right: 10px !important;
                width: 100% !important; /* Garante que o header ocupe toda a largura */
                height: auto !important; /* Permite que a altura se ajuste ao conteúdo que pode envolver */
                flex-wrap: wrap; /* Permite que os itens no header se quebrem para a próxima linha */
                justify-content: center; /* Centraliza os itens quando quebram */
            }

            #logo {
                margin-right: 10px !important;
                margin-left: 10px !important;
                margin-bottom: 10px; /* Adiciona margem inferior para separar do conteúdo abaixo */
            }
            #logo img {
                 max-height: 50px; /* Reduz levemente o tamanho da logo */
            }

            /* Botões Explorar e Meus Cursos */
            #exploreCatalogButton,
            #myCoursesButton {
                margin-left: 10px !important;
                margin-right: 10px !important;
                margin-bottom: 10px; /* Adiciona margem inferior para separar do conteúdo abaixo */
                padding: 8px 12px; /* Ajusta o padding */
                font-size: 0.9em; /* Ajusta o tamanho da fonte */
            }

            /* LOGIN SECTION */
            #login {
                margin-left: 0 !important;
                margin-right: 0 !important;
                width: 100%; /* Ocupa toda a largura */
                top: 0 !important; /* Reset position top */
                padding: 10px; /* Adiciona um pequeno padding geral ao login */
                box-sizing: border-box; /* Garante que padding não adicione largura */
            }

            #login-enter {
                flex-wrap: wrap; /* PERMITE QUE OS BLOCOS DE LOGIN QUEBREM A LINHA */
                justify-content: center; /* Centraliza os blocos quando quebram */
            }

            #login-form,
            #login-card,
            #login-instance {
                width: 100% !important; /* FORÇA A OCUPAR 100% DA LARGURA DISPONÍVEL */
                flex-basis: 100%; /* Força cada item a ocupar sua própria linha */
                margin: 10px auto !important; /* Ajusta margem vertical para espaçamento uniforme e centraliza */
                padding: 15px; /* Aumenta o padding interno das caixas de formulário */
                box-sizing: border-box; /* Garante que padding não adicione largura */
                border-radius: 8px; /* Adiciona um leve arredondamento nas bordas das caixas */
                background-color: rgba(59, 32, 74, 0.95); /* Adjusted to a darker purple for theme consistency */
                box-shadow: 0 2px 5px rgba(0,0,0,0.2); /* Adiciona uma sombra sutil */
            }
            #login-instance {
                margin-right: auto !important;
                margin-left: auto !important;
                border-radius: 8px; /* Adiciona um leve arredondamento nas bordas das caixas */
                box-shadow: 0 2px 5px rgba(0,0,0,0.2); /* Adiciona uma sombra sutil */
            }

            /* Targeted overrides for inline styles within #login-form */
            #login-form > form > div[style*="width:140px"], /* Targeting the email/cpf div */
            #login-form > form > div[style*="width:230px"] { /* Targeting the password div */
                width: 100% !important;
                float: none !important;
                margin-right: 0 !important;
                padding-left: 0 !important; /* Ensure no left padding from inline */
                box-sizing: border-box; /* Include padding in width */
                margin-bottom: 15px; /* Spacing between these two main form divs */
                text-align: center; /* Centraliza o conteúdo (labels e inputs) */
            }
            #login-form > form > div[style*="width:230px"] > input[type="password"] {
                float: none !important; /* Override inline float on password input */
                width: 100% !important;
                margin-right: 0 !important; /* Remove inline margin */
                margin-bottom: 10px; /* Spacing below password input */
            }
            #login-form input[type="text"],
            #login-form input[type="password"] {
                width: 100% !important; /* INPUT OCUPA 100% DA LARGURA */
                margin-bottom: 10px; /* Adicionado para espaçamento */
                text-align: center; /* Centraliza texto do input */
                padding: 10px 15px; /* Aumenta o padding interno dos inputs */
                border-radius: 5px; /* Leve arredondamento dos inputs */
                background-color: #f8f8f8 !important; /* Explicitly set for first two fields */
            }
            #login-form input[type="text"]::placeholder,
            #login-form input[type="password"]::placeholder {
                color: darkgray !important; /* Placeholder color set to darkgray for first two fields */
            }
            #login-form button[type="submit"] {
                float: none !important; /* Remove float para que ocupe a linha toda */
                width: 100% !important; /* Botão ocupa 100% da largura */
                margin-top: 5px; /* Espaço entre input e botão */
                padding: 12px 15px; /* Aumenta o padding do botão */
                font-size: 1.0em; /* Aumenta um pouco a fonte do botão */
                background-color: rgba(150, 110, 180, 0.9) !important; /* Lighter purple for first button, forced */
                color: white; /* Texto branco */
                border: none; /* Sem borda */
                border-radius: 5px;
            }
            #login-form button[type="submit"]:hover {
                background-color: rgba(120, 80, 150, 1) !important; /* Darker purple on hover, forced */
            }

            /* Adjustments for "Esqueceu a senha?" link */
            #login-form > form > div > a#senha {
                display: block; /* Ensures it's on its own line */
                text-align: center; /* Centers the link */
                margin-top: 10px; /* Adds space above */
                color: #B0C4DE; /* Cor mais clara para o link */
                font-size: 0.9em; /* Ajusta o tamanho da fonte */
            }

            /* Targeted overrides for inline flex on login-card and login-instance inner divs */
            #login-card > form > div[style*="display: flex"],
            #login-instance > div:first-of-type[style*="display: flex"] {
                display: block !important; /* Force stacking of input and button */
                align-items: stretch !important; /* Ensure consistent height if needed, though block will handle it */
                text-align: center; /* Centraliza o conteúdo */
            }
            #login-card > form > div > div,
            #login-instance > div:first-of-type > div {
                width: 100% !important; /* Input/label container takes full width */
                margin-right: 0 !important; /* Remove inline margin */
                margin-bottom: 10px; /* Space between input and button */
            }
            #login-card input,
            #login-instance input {
                width: 100% !important; /* Input occupies full available space */
                text-align: center; /* Centers input text */
                padding: 10px 15px; /* Aumenta o padding interno dos inputs */
                border-radius: 5px; /* Leve arredondamento dos inputs */
                background-color: lightgray !important; /* Explicitly set for third and fourth fields */
            }
            #login-card input::placeholder,
            #login-instance input::placeholder {
                color: gray !important; /* Placeholder color set to gray for third and fourth fields */
            }
            #login-card button,
            #login-instance button {
                width: 100% !important; /* Button occupies full width */
                padding: 12px 15px; /* Aumenta o padding do botão */
                margin-top: 5px; /* Espaço entre input e botão */
                font-size: 1.0em; /* Aumenta um pouco a fonte do botão */
                background-color: rgba(70, 70, 70, 0.8) !important; /* Grey for second and third buttons */
                color: white; /* Texto branco */
                border: none; /* Sem borda */
                border-radius: 5px;
            }
            #login-card button:hover,
            #login-instance button:hover {
                background-color: rgba(90, 90, 90, 0.9) !important; /* Darker grey on hover */
            }
            #login-card small,
            #login-instance small {
                display: block; /* Garante que fique em sua própria linha */
                text-align: center; /* Centraliza o texto */
                margin-top: 5px; /* Espaço acima */
                color: #B0C4DE; /* Cor mais clara para o texto informativo */
                font-size: 0.85em; /* Ajusta o tamanho da fonte */
            }

            /* Ícone de Engrenagem Admin */
            #gearIcon {
                display: none !important; /* Oculta em telas médias também */
            }
        }
    </style>
</head>

<body style="background-image: linear-gradient(to bottom, #503060, #3B204A); background-color: #3B204A; background-size: 100% 100%; background-repeat: no-repeat; background-position: 0 0;">
<div id="mainBackgroundImageContainer" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; background-image: url(https://d1yei2z3i6k35z.cloudfront.net/12974529/684265d14a4ab_SIECOverdesign02.jpg); background-size: 100% auto; background-repeat: no-repeat; background-position: center -5px; transition: filter 0.3s ease-out;"></div>
<div id="header" style="width: 100%;">
    <!-- Flexbox para alinhar pelo topo, login centralizado com margin auto -->
    <div class="in" style="position: fixed; top: 0; left: 0; width: 100%; display: flex; align-items: center; height: 70px; padding-top: 5px; padding-bottom: 5px;">
        <div id="logo" style="margin-right: 30px; margin-left: 30px;">
            <a href="https://geriah.com/">
            <img style="max-height:60px;" src="https://d1yei2z3i6k35z.cloudfront.net/3119789/68369d8fad915_GERiAHLOGO8donwload.png" alt="GERiAH"  />
            </a>
        </div>
        <!-- Botão Explorar Catálogo (fixo no header) -->
        <button id="exploreCatalogButton" type="button" style="margin-left: 20px; display: none;">Explorar Catálogo</button>
        <!-- Botão Meus Acessos (fixo no header) -->
        <button id="myCoursesButton" type="button" style="margin-left: 20px; display: none;">Meus Acessos</button>
        <!-- Ícone de Engrenagem Admin (Absoluto, oculto) -->
        <span id="gearIcon" style="position: fixed; top: 20px; left: -60px; display: none; font-size: 1.5em; cursor: pointer;">⚙️</span>
  
        <div id="login" style="margin-left: 30px; position: relative; top: 5px;">
            <div id="login-enter" style="display: flex; justify-content: flex-start; align-items: center;">
                <div id="login-form" style="margin-right: 10px; flex-shrink: 0;">
                    <form action="https://ava.sie.com.br/" method="post" id="frmLogin" target="_blank">
                        <input type="hidden" name="empresa" value="MATRIZ" />
                        <div style="width:140px;float:left;margin-right:5px;">
                            <label style="color: #D3D3D3;">E-mail ou CPF:</label>
                            <input autocomplete="username" class="text-input" name="email" type="text" id="email_id" size="20" required/>
                        </div>
                        <div style="width:230px;float:left;">
                            <label style="color: #D3D3D3;">Senha:</label>
                            <input autocomplete="current-password" class="text-input" name="pass" type="password" id="senha_id" size="20" style="float:left;margin-right:5px;" required/>
                            <button type="submit" style="float:left;">Enviar</button>
                            <br style="clear:both;" />
                            <a href="https://www.sie.com.br/email/" id="senha" style="font-size:12px;color:#D3D3D3; display: block; margin-top: 5px;">Esqueceu a senha?</a>
                        </div>
                    </form>
                </div>

                <!-- MOVIDO: Bloco ID da Instância agora virá DEPOIS do Código de Acesso -->
                <div id="login-card" style="margin-right: 40px; flex-shrink: 0; margin-left: 100px;">
                    <form action="/cartao/" method="POST" target="_blank">
                        <div style="display: flex; align-items: flex-end;">
                            <div style="margin-right: 5px;">
                                 <label style="color: #D3D3D3;">Código de Acesso</label>
                                <input required class="text-input" name="card_number" id="cartao_id" type="text" maxlength="20" size="20" placeholder="insira o codigo de 20 digitos"/>
                            </div>
                            <button type="submit">Enviar</button>
                        </div>
                        <small style="font-size:12px;color:#D3D3D3; display: block; margin-top: 5px;">Informe código de resgate</small>
                    </form>
                </div>

                <!-- START LOGIN POR ID (Agora na última posição) -->
                <div id="login-instance" style="margin-right: 10px; flex-shrink: 0;">
                    <div style="display: flex; align-items: flex-end;">
                        <div style="margin-right: 5px;">
                            <label for="instanceIdInput" style="display: block; color: #D3D3D3;">ID da Instância:</label>
                            <input class="text-input" type="text" id="instanceIdInput" size="20" placeholder="Somente Autoriazdo"/>
                        </div>
                        <button type="button" id="loginWithInstanceIdButton">Entrar com ID</button>
                    </div>
                    <small style="font-size:12px;color:#D3D3D3; display: block; margin-top: 5px;">Admin de Instância</small>
                </div>
                <!-- END LOGIN POR ID -->
            </div>
        </div>
        <!-- Botão Admin (fixo no header) -->
        <button id="adminButton" type="button" style="margin-left: 15px; display: none; cursor: pointer; padding: 6px 15px;">Admin</button>
    </div>
</div>

<!-- Seção do Catálogo de Conteúdos -->
<div id="catalogSection" style="display: none; padding: 20px;">
    <h2>Catálogo de Conteúdos</h2>
    <!-- Aqui virá a estrutura da aside (categorias) e main (carrosséis) portada de SIeClone06_Home GERiAH.html -->
    <p>Conteúdo do catálogo aparecerá aqui...</p>
</div>

<!-- Seção Meus Cursos -->
<div id="myCoursesSection" style="display:none; background-color: rgba(255, 255, 255, 0.90);">
    <br><br><h2>Meus Acessos</h2><br><br>
    <div id="myCoursesContainer">
        <!-- Lista de cursos será carregada aqui -->
    </div>
</div>

<!-- Seção Player do Curso (agora estilizada via CSS) -->
<div id="coursePlayerContainer" style="display: none; padding: 0; margin: 20px auto; background-color: darkgray; max-width: 90%; width: 900px; height: 600px;">
    <button id="closeCoursePlayerButton" style="position: absolute; top: 5px; right: 5px; z-index: 10; cursor: pointer; ">X</button>
    <!-- Iframe do curso será carregado aqui -->
</div>

<!-- Seção Admin (agora estilizada via CSS) -->
<div id="adminSection" style="display: none; margin: 20px auto; max-width: 90%; width: 800px;">
    <br><br><br><h2>Área Administrativa</h2><br><br><br>
    <div style="margin-bottom: 15px;"> <!-- Container para botões admin -->
        <button id="fetchTrailsButton" type="button" style="margin-right: 10px;">� Minhas Trilhas</button>
        <button id="createTrailButton" type="button" style="margin-right: 10px;">Criar Trilha</button>
        <!-- Botão de Importação de JSON de Trilha -->
        <button id="importTrailJsonButton" type="button" style="margin-right: 10px;">Importar JSON</button>
        <!-- Input File oculto para Importação -->
        <input type="file" id="importTrailJsonInput" accept=".json" style="display:none;">
        <button id="fetchEbooksButton" type="button" style="margin-right: 10px;">Obter eBooks</button>
        <button id="refreshAdminButton" type="button" title="Atualizar dados carregados">Atualizar</button>
        <button id="assistentesAdminButton" type="button" style="margin-left: 10px;">Assistentes de IA</button>
    </div>

    <!-- Campo de Busca por Curso nas Trilhas (inicialmente oculto) -->
    <div id="trailSearchContainer" style="margin-bottom: 15px; display: none;">
        <input type="text" id="trailCourseSearchInput" placeholder="Buscar curso em trilhas..." class="text-input" style="width: 50%; padding: 8px 10px;">
    </div>

    <!-- Formulário para Criar Trilha (ajustar estilo se necessário) -->
    <div id="createTrailFormContainer" style="display: none; margin-top: 15px; padding: 15px; border: 1px solid #ccc; background-color: #e9e9e9;">
        <h4>Nova Trilha</h4>
        <div style="margin-bottom: 10px;">
            <label for="newTrailTitle" style="display: block; margin-bottom: 5px;">Título:</label>
            <input type="text" id="newTrailTitle" name="newTrailTitle" style="width: 95%; padding: 5px;" required>
        </div>
        <div style="margin-bottom: 10px;">
            <label for="newTrailCourses" style="display: block; margin-bottom: 5px;">IDs dos Recursos (separados por vírgula):</label>
            <input type="text" id="newTrailCourses" name="newTrailCourses" style="width: 95%; padding: 5px;" placeholder="Ex: 864,1260,2458" required>
        </div>
        <button id="saveTrailButton" type="button">Salvar Trilha</button>
    </div>

    <div id="trailsContainer" style="margin-top: 15px;">
        <!-- Conteúdo das trilhas será carregado aqui -->
    </div>

    <!-- Container para eBooks -->
    <div id="ebooksContainer" style="margin-top: 15px; padding-top: 15px; border-top: 1px solid #ccc;">
        <!-- Conteúdo dos eBooks será carregado aqui -->
    </div>
</div>

<div id="footer">
   <!--  <div style="text-align:center;font-size:12px;font-family:sans-serif;"><a id="ico-politica" href="javascript:;" style="color:#666">Política de Privacidade</a></div> -->
    <!-- Excluído: Div #politica-de-priv -->
</div>

<!-- Excluídos: Scripts JQuery, Fancybox, MaskedInput, page.js, Cloudflare -->

<script>
document.addEventListener('DOMContentLoaded', () => {
    const loginForm = document.getElementById('frmLogin');
    const emailInput = document.getElementById('email_id');
    const passwordInput = document.getElementById('senha_id');
    const adminButton = document.getElementById('adminButton');
    const adminSection = document.getElementById('adminSection');
    const gearIcon = document.getElementById('gearIcon');
    const fetchTrailsButton = document.getElementById('fetchTrailsButton');
    const trailsContainer = document.getElementById('trailsContainer');
    const createTrailButton = document.getElementById('createTrailButton');
    const createTrailFormContainer = document.getElementById('createTrailFormContainer');
    const newTrailTitleInput = document.getElementById('newTrailTitle');
    const newTrailCoursesInput = document.getElementById('newTrailCourses');
    const saveTrailButton = document.getElementById('saveTrailButton');
    const fetchEbooksButton = document.getElementById('fetchEbooksButton');
    const ebooksContainer = document.getElementById('ebooksContainer');
    const refreshAdminButton = document.getElementById('refreshAdminButton');
    const myCoursesButton = document.getElementById('myCoursesButton');
    const myCoursesSection = document.getElementById('myCoursesSection');
    const myCoursesContainer = document.getElementById('myCoursesContainer');
    const coursePlayerContainer = document.getElementById('coursePlayerContainer');
    const loginCardDiv = document.getElementById('login-card');
    const closeCoursePlayerButton = document.getElementById('closeCoursePlayerButton');
    const trailSearchContainer = document.getElementById('trailSearchContainer'); // Referência para o container da busca
    const instanceIdInput = document.getElementById('instanceIdInput');
    const loginWithInstanceIdButton = document.getElementById('loginWithInstanceIdButton');
    const importTrailJsonButton = document.getElementById('importTrailJsonButton');
    const importTrailJsonInput = document.getElementById('importTrailJsonInput');
    const assistentesAdminButton = document.getElementById('assistentesAdminButton'); // NOVO: Referência ao botão Assistentes de IA

    // --- Elementos para o Modal do Catálogo via Iframe ---
    const catalogModal = document.getElementById('catalogModal');
    const catalogIframe = document.getElementById('catalogIframe');
    const closeCatalogModalButton = document.getElementById('closeCatalogModalButton');
    const exploreCatalogBtn = document.getElementById('exploreCatalogButton'); // Já referenciado antes
    // ADICIONADO: URL para a API de zerar/cancelar cursos
    const setResetCourseApiUrl = 'https://www.iped.com.br/api/course/set-reset';
    // --- Fim Elementos Modal Catálogo ---

    const apiToken = 'dbb2c4d19a5ef0fec48e363618611614b4e0dfce'; // Token 29233 fnwviedeos (Pai) - Restaurado como padrão
    // const apiToken = 'a721b3ce16d7beb657de2e22fb9bb6e08d28de2f'; // Token da Instância 29220 (Filial) - Comentado
    const loginApiUrl = 'https://www.iped.com.br/api/user/login';
    const trailsApiUrl = 'https://www.iped.com.br/api/trail/get-trails';
    const setTrailApiUrl = 'https://www.iped.com.br/api/trail/set-trail';
    const ebooksApiUrl = 'https://www.iped.com.br/api/ebook/get-ebooks';
    const courseInProgressApiUrl = 'https://www.iped.com.br/api/course/get-inprogress';
    const courseEnvApiUrl = 'https://www.iped.com.br/api/course/get-environment';

    let loggedInUserId = null;
    let loggedInUserToken = null;
    let currentTrailsData = []; // Guarda os dados das trilhas carregadas
    let loggedInUserEmail = null; // ADICIONADO: para guardar email do admin logado
    let loggedInUserApiToken = null; // ADICIONADO: para guardar o token usado no login bem-sucedido

    // INSEGURO - APENAS PARA TESTE LOCAL: Mapeamento de ID -> Credenciais e Token
    const instanceCredentials = {
        'MATRIZ': { email: 'sobral.pessoal@gmail.com', password: 'sobpessoal25A$', token: '6a2f35f5b59eee441a72b515f83271bbf85ef3d4' },
        '29690':  { email: 'demob2b@fnw.com', password: 'demob2b25A$', token: '232f7418404f74ee7778d1973ea984bb5686dbdb' },
        '29689':  { email: 'demob2c@fnw.com', password: 'demob2c25A$', token: '027279a16eee70e0f0d1a84d5acadb4beb17bc3f' },
        '29220':  { email: 'lab.freenat@gmail.com', password: 'labfnw25A$', token: 'a721b3ce16d7beb657de2e22fb9bb6e08d28de2f' },
        '29233':  { email: 'fnw.videos@gmail.com', password: 'fnwvideos25A$' , token: 'dbb2c4d19a5ef0fec48e363618611614b4e0dfce' }, // Senha não estava no doc/imagem
        '29445':  { email: 'fnw@freenatwork.com', password: 'fnwfnw25A$', token: '2d6f9af00b69bc17b84b8b8eee4f28d27d0fc8b1' },
        '29192':  { email: 'freenatwork.21@gmail.com', password: 'fnw2125A$', token: '1d482402e5c4800c2e5c82d6be9fed100cfb2797' }
        // Adicione outras instâncias aqui se necessário
        // ATENÇÃO: Senha da 29233 não foi fornecida, precisa ser adicionada manualmente se quiser testar.
    };

    // Lista de e-mails autorizados para ver os controles de admin (Admin FNW principal)
    const authorizedAdminEmails = [
        'sobral.pessoal@gmail.com'
    ].map(email => email.toLowerCase()); // Normaliza para minúsculas

    // Função para RENDERIZAR as trilhas no container
    function renderTrails(trailsArray) {
        let trailsHtml = '';
        if (!trailsArray || trailsArray.length === 0) {
            trailsHtml = '<p>Nenhuma trilha encontrada (ou correspondente ao filtro).</p>';
        } else {
            trailsArray.forEach(trail => {
                const trailId = trail.trail_id;
                // Lógica de geração do HTML da trilha (copiada/movida de fetchAndDisplayTrails)
                trailsHtml += `
                    <div class="trail-item" style="border: 1px solid #ddd; padding: 10px; margin-bottom: 10px; background: #fff;">
                        <div style="display: flex; justify-content: space-between; align-items: center; cursor: pointer;" class="toggle-details" data-trail-id="${trailId}">
                            <h4>${trail.trail_title || 'Trilha sem título'}</h4>
                            <span class="toggle-icon" style="font-size: 1.2em;">▼</span>
                        </div>
                        <div class="trail-details" id="details-${trailId}" style="display: none; margin-top: 10px; padding-top: 10px; border-top: 1px dashed #eee;">
                            <p><strong>Objetivo:</strong> ${trail.trail_objective || 'N/A'}</p>
                            <p><strong>Prazo:</strong> ${trail.trail_conclusion_date || 'N/A'}</p>
                            ${trail.trail_conclusion_message ? `<p><strong>Mensagem:</strong> ${trail.trail_conclusion_message}</p>` : ''}
                            <div class="courses-list" style="margin-top: 10px;">
                `;
                if (trail.trail_courses && trail.trail_courses.length > 0) {
                    trailsHtml += '<ul>';
                    trail.trail_courses.forEach(course => {
                        let courseTitle = course.course_title || `ID ${course.course_id || 'Desconhecido'}`;
                        if (typeof courseTitle === 'string') {
                            if (courseTitle.toLowerCase().startsWith('curso de ')) {
                                courseTitle = courseTitle.substring(9);
                            } else if (courseTitle.toLowerCase().startsWith('curso ')) {
                                courseTitle = courseTitle.substring(6);
                            }
                        }
                        const availability = course.course_trail_available === 1 ? 'Disponível' : 'Indisponível';
                        const message = course.course_trail_message ? `(${course.course_trail_message})` : '';
                        trailsHtml += `
                            <li class="course-item" data-course-id="${course.course_id}" style="cursor: pointer; margin-bottom: 3px;">
                                ${courseTitle} ${message}
                            </li>
                        `;
                    });
                    trailsHtml += '</ul>';
                } else {
                    trailsHtml += '<p>Nenhum item nesta trilha.</p>';
                }
                trailsHtml += '</div></div></div>'; 
            });
        }
        trailsContainer.innerHTML = trailsHtml;
        // Nota: Poderíamos re-aplicar listeners específicos aqui se necessário, mas o delegado deve funcionar.
    }

    // Função para buscar e exibir as trilhas (agora controla visibilidade da busca)
    async function fetchAndDisplayTrails() {
        if (!loggedInUserId || !loggedInUserApiToken) {
            trailsContainer.innerHTML = '<p>Erro: Usuário não logado ou token inválido.</p>';
            currentTrailsData = [];
            renderTrails(currentTrailsData);
            trailSearchContainer.style.display = 'none'; // Esconde busca no erro
            return;
        }

        trailsContainer.innerHTML = '<p>Carregando trilhas...</p>';
        trailsContainer.style.display = 'block';
        trailSearchContainer.style.display = 'none'; // Esconde busca enquanto carrega

        const formData = new FormData();
        formData.append('token', loggedInUserApiToken);
        formData.append('user_id', loggedInUserId);
        formData.append('all_formats', 'true'); // Adicionado para retornar todos os formatos nas trilhas

        try {
            const response = await fetch(trailsApiUrl, {
                method: 'POST',
                body: formData
            });
            if (!response.ok) throw new Error(`Erro HTTP: ${response.status}`);
            const result = await response.json();

            if (result.STATE === 1 && result.TRAILS) {
                currentTrailsData = result.TRAILS;
                document.getElementById('trailCourseSearchInput').value = '';
                renderTrails(currentTrailsData);
                trailSearchContainer.style.display = 'block'; // MOSTRA busca se sucesso
            } else if (result.STATE === 0 && result.ERROR) {
                trailsContainer.innerHTML = `<p>Erro ao buscar trilhas: ${result.ERROR}</p>`;
                currentTrailsData = [];
                trailSearchContainer.style.display = 'none'; // Esconde busca no erro
            } else {
                trailsContainer.innerHTML = '<p>Erro inesperado ao buscar trilhas.</p>';
                console.error('Resposta inesperada da API de trilhas:', result);
                currentTrailsData = [];
                trailSearchContainer.style.display = 'none'; // Esconde busca no erro
            }
        } catch (error) {
            trailsContainer.innerHTML = `<p>Falha ao conectar com a API de trilhas: ${error.message}</p>`;
            console.error('Erro na chamada da API de trilhas:', error);
            currentTrailsData = [];
            trailSearchContainer.style.display = 'none'; // Esconde busca no erro
        }
    }

    // Função para criar a trilha
    async function createTrail() {
        const title = newTrailTitleInput.value.trim();
        const courses = newTrailCoursesInput.value.trim();

        if (!title || !courses) {
            alert('Por favor, preencha o título e os IDs dos recursos.');
            return;
        }

        if (!loggedInUserId || !loggedInUserToken) {
            alert('Erro: Informações do usuário logado não encontradas. Faça login novamente.');
            return;
        }

        // Simples validação para IDs de cursos (apenas verifica se não está vazio e contém números/vírgulas)
        if (!/^[\d,]+$/.test(courses)) {
            alert('Formato inválido para IDs dos Recursos. Use apenas números separados por vírgula.');
            return;
        }

        saveTrailButton.disabled = true;
        saveTrailButton.textContent = 'Salvando...';

        const formData = new FormData();
        formData.append('token', loggedInUserApiToken);
        formData.append('user_id', loggedInUserId);
        formData.append('user_token', loggedInUserToken);
        formData.append('title', title);
        formData.append('courses', courses);
        formData.append('all_formats', 'true'); // Adicionado para que a criação da trilha considere todos os formatos

        try {
            const response = await fetch(setTrailApiUrl, {
                method: 'POST',
                body: formData
            });
            if (!response.ok) throw new Error(`Erro HTTP: ${response.status}`);
            const result = await response.json();

            if (result.STATE === 1 && result.SUCCESS) {
                alert(result.SUCCESS);
                createTrailFormContainer.style.display = 'none';
                newTrailTitleInput.value = '';
                newTrailCoursesInput.value = '';
                fetchAndDisplayTrails();
            } else if (result.STATE === 0 && result.ERROR) {
                alert(`Erro ao criar trilha: ${result.ERROR}`);
            } else {
                alert('Erro inesperado ao criar trilha.');
                console.error('Resposta inesperada da API set-trail:', result);
            }
        } catch (error) {
            alert(`Falha ao conectar com a API para criar trilha: ${error.message}`);
            console.error('Erro na chamada da API set-trail:', error);
        } finally {
            saveTrailButton.disabled = false;
            saveTrailButton.textContent = 'Salvar Trilha';
        }
    }

    // Função para buscar e exibir os eBooks
    async function fetchAndDisplayEbooks() {
        // Restaurado: Validação de login
        if (!loggedInUserId || !loggedInUserToken) {
            ebooksContainer.innerHTML = '<p>Erro: Usuário não logado.</p>';
            return;
        }

        ebooksContainer.innerHTML = '<p>Carregando eBooks...</p>'; // Mensagem original restaurada
        ebooksContainer.style.display = 'block'; // Garante visibilidade ao carregar/erro

        // Restaurado: Código Original da API
        const formData = new FormData();
        formData.append('token', loggedInUserApiToken);
        formData.append('user_id', loggedInUserId);
        formData.append('user_token', loggedInUserToken);

        try {
            const response = await fetch(ebooksApiUrl, {
                method: 'POST',
                body: formData
            });
            if (!response.ok) throw new Error(`Erro HTTP: ${response.status}`);
            const result = await response.json();

            if (result.STATE === 1 && result.EBOOKS) {
                let ebooksHtml = '<h4>eBooks Disponíveis</h4>';
                if (result.EBOOKS.length === 0) {
                    ebooksHtml += '<p>Nenhum eBook encontrado.</p>'; // Mensagem se a lista estiver vazia
                } else {
                    ebooksHtml += '<ul>';
                    result.EBOOKS.forEach(ebook => {
                        ebooksHtml += `
                            <li>
                                <strong>${ebook.ebook_title || 'eBook sem título'}</strong>
                                ${ebook.ebook_url ? `<a href="${ebook.ebook_url}" target="_blank" style="margin-left: 10px;">(Acessar)</a>` : ''}
                                ${ebook.ebook_description ? `<p style="font-size: 0.9em; margin-left: 15px;">${ebook.ebook_description}</p>` : ''}
                            </li>
                        `;
                    });
                    ebooksHtml += '</ul>';
                }
                ebooksContainer.innerHTML = ebooksHtml;
            } else if (result.STATE === 0 && result.ERROR) {
                ebooksContainer.innerHTML = `<p>Erro ao buscar eBooks: ${result.ERROR}</p>`;
            } else {
                ebooksContainer.innerHTML = '<p>Erro inesperado ao buscar eBooks.</p>';
                console.error('Resposta inesperada da API de eBooks:', result);
            }
        } catch (error) {
            ebooksContainer.innerHTML = `<p>Falha ao conectar com a API de eBooks: ${error.message}</p>`;
            console.error('Erro na chamada da API de eBooks:', error);
        }
    }

    // Função para mostrar/ocultar a seção admin
    function toggleAdminSection() {
        const isHidden = adminSection.style.display === 'none';
        adminSection.style.display = isHidden ? 'block' : 'none';
        if (isHidden) {
            // Rola para a seção admin quando ela é exibida
            adminSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }
    }

    // Função para buscar e exibir Meus Cursos (agora usa get-inprogress)
    async function fetchAndDisplayMyCourses() {
        if (!loggedInUserId || !loggedInUserToken || !loggedInUserApiToken) {
            myCoursesContainer.innerHTML = '<p>Erro: Usuário não logado ou informações incompletas.</p>';
            myCoursesSection.style.display = 'block';
            // Rola para a seção mesmo em caso de erro (para mostrar a mensagem)
            myCoursesSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
            return;
        }
        myCoursesContainer.innerHTML = '<p>Carregando seus recursos em andamento...</p>';
        myCoursesSection.style.display = 'block';
        // Rola para a seção Meus Cursos quando ela é exibida
        myCoursesSection.scrollIntoView({ behavior: 'smooth', block: 'start' });

        const formData = new FormData();
        formData.append('token', loggedInUserApiToken);
        formData.append('user_id', loggedInUserId);
        formData.append('user_token', loggedInUserToken);
        formData.append('all_formats', 'true'); // Adicionado para retornar todos os formatos

        try {
            const response = await fetch(courseInProgressApiUrl, { method: 'POST', body: formData });
            if (!response.ok) throw new Error(`Erro HTTP: ${response.status}`);
            const result = await response.json();

            // Verifica se a resposta contém o array COURSES
            if (result.STATE === 1 && result.COURSES) {
                console.log('Dados de cursos recebidos da API:', result.COURSES); // ADICIONADO PARA DEBUG
                let coursesHtml = '';
                if (result.COURSES.length === 0) {
                    coursesHtml = '<p>Nenhum recurso em andamento encontrado.</p>';
                } else {
                    coursesHtml += '<ul>';
                    result.COURSES.forEach(course => {
                        // A resposta de get-inprogress já tem mais detalhes
                        let courseTitle = course.course_title || 'Sem título'; // Similar à trilha, remove "Curso" se existir
                        if (typeof courseTitle === 'string') {
                            if (courseTitle.toLowerCase().startsWith('curso de ')) {
                                courseTitle = courseTitle.substring(9);
                            } else if (courseTitle.toLowerCase().startsWith('curso ')) {
                                courseTitle = courseTitle.substring(6);
                            }
                        }
                        if (!courseTitle && course.course_id) { // Fallback para ID se o título ficou vazio
                            courseTitle = `ID ${course.course_id}`;
                        }

                        const progress = course.course_user?.user_course_completed;
                        coursesHtml += `
                            <li class="course-item" data-course-id="${course.course_id}" style="cursor: pointer; margin-bottom: 5px; padding: 5px; border-bottom: 1px solid #eee; display: flex; align-items: center; justify-content: space-between;">
                                <div>
                                    <strong>${courseTitle}</strong>
                                    ${progress !== undefined ? `<span style="margin-left: 10px;">(${progress}%)</span>` : ''}
                                </div>
                                <div style="display: flex; gap: 5px;">
                                    <button class="reset-course-button" data-course-id="${course.course_id}">Zerar</button>
                                    <button class="hide-course-button" data-course-id="${course.course_id}">Ocultar</button>
                                </div>
                            </li>
                        `;
                    });
                    coursesHtml += '</ul>';
                }
                myCoursesContainer.innerHTML = coursesHtml;

                // ADICIONADO: Adicionar o botão "Zerar Todos"
                if (result.COURSES.length > 0) {
                    const resetAllButton = document.createElement('button');
                    resetAllButton.id = 'resetAllCoursesButton';
                    resetAllButton.className = 'reset-all-courses-button';
                    resetAllButton.textContent = 'Zerar Todos os Meus Acessos';
                    myCoursesContainer.prepend(resetAllButton); // Adiciona antes do conteúdo atual

                    // ADICIONADO: Botão "Limpar Display"
                    const clearDisplayButton = document.createElement('button');
                    clearDisplayButton.id = 'clearMyCoursesDisplayButton';
                    clearDisplayButton.className = 'clear-display-button';
                    clearDisplayButton.textContent = 'Limpar Display';
                    // Encontra o resetAllButton e insere o novo botão ao lado
                    resetAllButton.parentNode.insertBefore(clearDisplayButton, resetAllButton.nextSibling);
                }

            } else if (result.STATE === 0 && result.ERROR) {
                myCoursesContainer.innerHTML = `<p>Erro ao buscar recursos: ${result.ERROR}</p>`;
            } else {
                myCoursesContainer.innerHTML = '<p>Erro inesperado ao buscar recursos (resposta inválida).</p>';
                console.error('Resposta inesperada da API get-inprogress:', result);
            }
        } catch (error) {
            myCoursesContainer.innerHTML = `<p>Falha ao conectar com a API de recursos: ${error.message}</p>`;
            console.error('Erro na chamada da API get-inprogress:', error);
        }
    }

    // Função para carregar o ambiente do curso
    async function loadCourseEnvironment(courseId) {
        if (!loggedInUserId || !loggedInUserToken || !loggedInUserApiToken) {
            coursePlayerContainer.innerHTML = '<p style="color: white; padding: 20px;">Erro: Usuário não logado ou informações incompletas.</p>';
            coursePlayerContainer.style.display = 'block';
            return;
        }
        // Encontra o botão fechar ANTES de limpar
        const closeButton = coursePlayerContainer.querySelector('#closeCoursePlayerButton');
        coursePlayerContainer.innerHTML = ''; // Limpa container
        if (closeButton) {
            // Remove estilos inline que agora estão no CSS
            closeButton.style.backgroundColor = '';
            closeButton.style.color = '';
            closeButton.style.border = '';
            closeButton.style.padding = '';
            closeButton.style.fontSize = '';
            closeButton.style.borderRadius = '';
            // Mantém os essenciais
            // closeButton.style.position = 'absolute'; 
            // closeButton.style.top = '5px'; 
            // closeButton.style.right = '5px'; 
            // closeButton.style.zIndex = '1001'; 
            // closeButton.style.cursor = 'pointer';
            coursePlayerContainer.appendChild(closeButton); // Readiciona o botão
        }
        
        const loadingMessage = document.createElement('p');
        loadingMessage.textContent = 'Carregando ambiente do recurso...';
        loadingMessage.style.color = 'white';
        loadingMessage.style.padding = '20px';
        coursePlayerContainer.appendChild(loadingMessage);

        coursePlayerContainer.style.display = 'block';
        coursePlayerContainer.scrollIntoView({ behavior: 'smooth', block: 'center' });

        const formData = new FormData();
        formData.append('token', loggedInUserApiToken);
        formData.append('user_id', loggedInUserId);
        formData.append('user_token', loggedInUserToken);
        formData.append('course_id', courseId);
        formData.append('course_layout', '2'); // Layout padrão
        formData.append('course_activities', '1'); // ADICIONADO: Parâmetro obrigatório (1 = Ativar)

        try {
            const response = await fetch(courseEnvApiUrl, { method: 'POST', body: formData });
            if (!response.ok) throw new Error(`Erro HTTP: ${response.status}`);
            const result = await response.json();
            
            // ADICIONADO: Log da resposta completa da API para depuração
            //console.log('Resposta da API course environment:', result);

            // Remove mensagem de carregamento
            if(loadingMessage) loadingMessage.remove();

            if (result.STATE === 1 && result.ENVIRONMENT && result.ENVIRONMENT.course_iframe_url) {
                // Cria e adiciona o iframe dinamicamente
                const iframe = document.createElement('iframe');
                iframe.src = result.ENVIRONMENT.course_iframe_url;
                iframe.style.width = '100%';
                iframe.style.height = '100%';
                iframe.style.border = 'none';
                iframe.allowFullscreen = true;
                iframe.allow = 'accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture';
                coursePlayerContainer.appendChild(iframe);

            } else if (result.STATE === 0 && result.ERROR) {
                const errorMessage = document.createElement('p');
                errorMessage.textContent = `Erro ao carregar recurso: ${result.ERROR}`;
                errorMessage.style.color = 'white';
                errorMessage.style.padding = '20px';
                coursePlayerContainer.appendChild(errorMessage);
            } else {
                const errorMessage = document.createElement('p');
                errorMessage.textContent = 'Erro inesperado ao carregar recurso.';
                errorMessage.style.color = 'white';
                errorMessage.style.padding = '20px';
                coursePlayerContainer.appendChild(errorMessage);
                console.error('Resposta inesperada da API course environment:', result);
            }
        } catch (error) {
            // Remove mensagem de carregamento em caso de erro de fetch
            if(loadingMessage) loadingMessage.remove();
            const errorMessage = document.createElement('p');
            errorMessage.textContent = `Falha ao conectar com a API do recurso: ${error.message}`;
            errorMessage.style.color = 'white';
            errorMessage.style.padding = '20px';
            coursePlayerContainer.appendChild(errorMessage);
            console.error('Erro na chamada da API course environment:', error);
        }
    }

    // Função UNIFICADA para processar o resultado do login (chamada por ambos os métodos)
    function handleLoginSuccess(result, userEmail, tokenUsed) {
        loggedInUserId = result.USER_ID;
        loggedInUserToken = result.USER_TOKEN;
        loggedInUserEmail = userEmail;
        loggedInUserApiToken = tokenUsed; // ADICIONADO: guarda o token da API da instância/pai que funcionou

        // Aplica o blur na imagem de fundo principal
        const mainBgContainer = document.getElementById('mainBackgroundImageContainer');
        if (mainBgContainer) {
            mainBgContainer.style.backgroundImage = 'url(\'https://d1yei2z3i6k35z.cloudfront.net/12974529/6843ab1ccb475_SIEGERIAHbackgroundacesso2Logo-donwload.png\')';
        }

        // Ajusta a posição da logo após o login
        const logoImg = document.querySelector('#logo img');
        if (logoImg) {
            logoImg.style.position = 'relative';
            logoImg.style.top = '-8px';
        }

        // Esconde todos os forms de login, mostra botão Conteúdos
        loginForm.style.display = 'none';
        if (loginCardDiv) loginCardDiv.style.display = 'none';
        const loginInstanceDiv = document.getElementById('login-instance'); // Esconde form de ID tbm
        if (loginInstanceDiv) loginInstanceDiv.style.display = 'none';
        myCoursesButton.style.display = 'inline-block'; // Troca para inline-block

        // MOSTRA o botão Explorar Catálogo para todos os usuários logados
        const exploreCatalogBtn = document.getElementById('exploreCatalogButton');
        if (exploreCatalogBtn) {
            exploreCatalogBtn.style.display = 'inline-block';
            // ADICIONADO: Abrir o modal do catálogo automaticamente após o login
            exploreCatalogBtn.click(); 
        }

        // Referência ao título da seção
        const adminSectionTitle = document.querySelector('#adminSection h2');

        // Mostra controles admin FNW SE o e-mail logado for o autorizado
        const loggedInEmailNormalized = userEmail.trim().toLowerCase();
        if (authorizedAdminEmails.includes(loggedInEmailNormalized)) {
            adminButton.style.display = 'inline-block'; // Troca para inline-block
            gearIcon.style.display = 'inline-block'; // Troca para inline-block
            adminSection.style.display = 'none'; // Inicia oculto mesmo para admins
            if (adminSectionTitle) adminSectionTitle.textContent = 'Área Administrativa';
        } else {
            adminButton.style.display = 'none';
            gearIcon.style.display = 'none';
            adminSection.style.display = 'block'; // Mostra automaticamente apenas botão Minhas Trilhas para usuários comuns
            // Esconde todos os botões admin exceto Minhas Trilhas para usuários não-admin
            createTrailButton.style.display = 'none';
            fetchEbooksButton.style.display = 'none';
            refreshAdminButton.style.display = 'none';
            // Muda o título da seção
            if (adminSectionTitle) adminSectionTitle.textContent = 'Minhas Trilhas de Aprendizado';
            // Busca trilhas automaticamente
            fetchAndDisplayTrails();
        }
        // Oculta seções que podem estar abertas de um login anterior
        myCoursesSection.style.display = 'none';
        coursePlayerContainer.style.display = 'none';
    }

    // Função para realizar a chamada da API de login (AGORA ACEITA TOKEN ESPECÍFICO)
    async function performLogin(userEmail, userPassword, instanceToken = apiToken) {
        // Usa instanceToken se fornecido, senão usa o apiToken global (para login via form principal)
        const currentApiToken = instanceToken;

        const loginFormData = new FormData();
        loginFormData.append('token', currentApiToken); // USA O TOKEN CORRETO (global ou específico da instância)
        loginFormData.append('user_email', userEmail);
        loginFormData.append('user_password', userPassword);

        try {
            const response = await fetch(loginApiUrl, {
                method: 'POST',
                body: loginFormData
            });
            if (!response.ok) throw new Error(`Erro HTTP: ${response.status}`);
            const result = await response.json();

            if (result.STATE === 1 && result.USER_ID && result.USER_TOKEN) {
                handleLoginSuccess(result, userEmail, currentApiToken); // Passa o token que foi usado com sucesso
            } else if (result.STATE === 0 && result.ERROR) {
                alert(`Erro: ${result.ERROR}`);
            } else {
                alert('Erro inesperado ao tentar fazer login ou dados faltando na resposta (USER_ID/USER_TOKEN).');
                console.error('Resposta inesperada da API de login:', result);
            }
        } catch (error) {
            alert(`Falha ao conectar com a API de login: ${error.message}`);
            console.error('Erro na chamada da API de login:', error);
        }
    }

    // Adicionado console.log para depuração
    console.log('Verificando elementos para adicionar listeners...');

    // Verifica se todos os elementos necessários existem (incluindo os novos para Login por ID)
    const trailCourseSearchInput = document.getElementById('trailCourseSearchInput');
    // START LOGIN POR ID (TEMPORARIO) - Verificação de elementos
    if (loginForm && emailInput && passwordInput && adminButton && adminSection && gearIcon && fetchTrailsButton && trailsContainer && createTrailButton && createTrailFormContainer && newTrailTitleInput && newTrailCoursesInput && saveTrailButton && fetchEbooksButton && ebooksContainer && refreshAdminButton && myCoursesButton && myCoursesSection && myCoursesContainer && coursePlayerContainer && loginCardDiv && closeCoursePlayerButton && trailCourseSearchInput && trailSearchContainer && instanceIdInput && loginWithInstanceIdButton && importTrailJsonButton && importTrailJsonInput) {
    // END LOGIN POR ID (TEMPORARIO) - Verificação de elementos

        // ADICIONADO: Define o texto inicial do botão Meus Cursos
        myCoursesButton.textContent = 'Mostrar Meus Acessos';

        // Listener do Login PADRÃO (E-mail/Senha)
        loginForm.addEventListener('submit', async (event) => {
            event.preventDefault();
            const userEmail = emailInput.value;
            const userPassword = passwordInput.value;
            await performLogin(userEmail, userPassword); // Chama a função de login
        });

        // START LOGIN POR ID (COMENTADO - AGUARDANDO SUPABASE)
        // NOVO: Listener do Login por ID da Instância (Deve funcionar agora)
        // Adicionado console.log para depuração
        console.log('Adicionando listener ao botão Entrar com ID');
        loginWithInstanceIdButton.addEventListener('click', async () => {
            const instanceIdInput = document.getElementById('instanceIdInput'); // Garantir que temos a referência aqui dentro
            const instanceId = instanceIdInput.value.trim().toUpperCase(); // Pegar o ID e normalizar para maiúsculas

            if (!instanceId) {
                alert('Por favor, digite o ID da Instância.');
                return;
            }

            // Procurar as credenciais e token no objeto (INSEGURO)
            const credentials = instanceCredentials[instanceId];

            if (credentials) {
                // VERIFICA SE TEM SENHA (Ex: ID 29233 pode não ter)
                if (!credentials.password || credentials.password === '???') {
                    alert(`Senha para ID da Instância "${instanceId}" não está configurada no código. Login não pode continuar.`);
                    console.warn(`Senha faltando para ID ${instanceId}`);
                    return; // Interrompe aqui se a senha não estiver definida
                }

                console.log(`Credenciais e Token encontrados para ID ${instanceId}: ${credentials.email}, Token: ${credentials.token}`);
                // Chamar a função de login normal com as credenciais E O TOKEN específico
                loginWithInstanceIdButton.disabled = true;
                loginWithInstanceIdButton.textContent = 'Entrando...';
                try {
                    await performLogin(credentials.email, credentials.password, credentials.token); // Passa o token específico
                    instanceIdInput.value = ''; // Limpar campo após tentativa (sucesso ou falha)
                } catch (error) {
                    // performLogin já mostra alerta, apenas logamos aqui
                    console.error("Erro durante performLogin chamado por Entrar com ID:", error);
                } finally {
                    loginWithInstanceIdButton.disabled = false;
                    loginWithInstanceIdButton.textContent = 'Entrar com ID';
                }
            } else {
                alert(`ID da Instância "${instanceId}" não encontrado ou inválido.`);
                console.warn(`ID da Instância não encontrado no mapeamento: ${instanceId}`);
            }
        });
        // END LOGIN POR ID (IMPLEMENTADO DE FORMA INSEGURA PARA TESTE)

        // Listener do botão Admin (usa função toggle)
        adminButton.addEventListener('click', toggleAdminSection);

        // Listener do ÍCONE Engrenagem (usa a MESMA função toggle)
        gearIcon.addEventListener('click', toggleAdminSection);

        // Listener do botão Obter Trilhas (agora esconde/mostra busca)
        fetchTrailsButton.addEventListener('click', () => {
            if (trailsContainer.style.display === 'block' && trailCourseSearchInput.value === '') {
                trailsContainer.style.display = 'none';
                trailSearchContainer.style.display = 'none'; // Esconde busca junto
                currentTrailsData = []; 
            } else {
                fetchAndDisplayTrails(); 
                // Não precisa mostrar a busca aqui, fetchAndDisplayTrails faz isso
            }
        });

        // Listener do botão Criar Trilha (já toggle)
        createTrailButton.addEventListener('click', () => {
            const formWasHidden = createTrailFormContainer.style.display === 'none';
            createTrailFormContainer.style.display = formWasHidden ? 'block' : 'none';
            if (formWasHidden) {
                // Rola para o formulário quando ele é exibido
                createTrailFormContainer.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }
        });

        // Listener do botão Salvar Trilha
        saveTrailButton.addEventListener('click', createTrail);

        // Listener do botão Obter eBooks (agora toggle)
        fetchEbooksButton.addEventListener('click', () => {
            if (ebooksContainer.style.display === 'block') {
                ebooksContainer.style.display = 'none';
            } else {
                fetchAndDisplayEbooks(); // Chama a função que eventualmente mostra o container
                // Rola para o container após iniciar a busca e centraliza
                ebooksContainer.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }
        });

        // Listener do botão Atualizar
        refreshAdminButton.addEventListener('click', () => {
            console.log('Atualizando dados admin...');
            // Verifica se as trilhas já foram carregadas (não é o estado inicial/erro/carregando)
            if (trailsContainer.innerHTML && !trailsContainer.innerHTML.includes('<p>Carregando') && !trailsContainer.innerHTML.includes('<p>Erro:')) {
                console.log('Recarregando trilhas...');
                fetchAndDisplayTrails();
            }
            // Verifica se os eBooks já foram carregados
            if (ebooksContainer.innerHTML && !ebooksContainer.innerHTML.includes('<p>Carregando') && !ebooksContainer.innerHTML.includes('<p>Erro:')) {
                console.log('Recarregando eBooks...');
                fetchAndDisplayEbooks();
            }
        });

        // Listener delegado para expandir/recolher detalhes da trilha E CLICAR EM CURSOS
        trailsContainer.addEventListener('click', (event) => {
            const detailsHeader = event.target.closest('.toggle-details');
            const courseItem = event.target.closest('.course-item');

            if (detailsHeader) { // Clicou no header da trilha
                const trailId = detailsHeader.dataset.trailId;
                const detailsDiv = document.getElementById(`details-${trailId}`);  
                const iconSpan = detailsHeader.querySelector('.toggle-icon');
                if (detailsDiv && iconSpan) {
                    const isHidden = detailsDiv.style.display === 'none';
                    detailsDiv.style.display = isHidden ? 'block' : 'none';
                    iconSpan.textContent = isHidden ? '▲' : '▼';
                }
            } else if (courseItem && courseItem.dataset.courseId) { // Clicou em um item de curso
                loadCourseEnvironment(courseItem.dataset.courseId);
            }
        });

        // Listener do botão Meus Cursos (agora toglge mostra/esconde e recarrega)
        myCoursesButton.addEventListener('click', () => {
            // Verifica o estado atual da seção Meus Acessos
            const isMyCoursesSectionVisible = myCoursesSection.style.display === 'block';

            if (isMyCoursesSectionVisible) {
                // Se estiver visível, OCULTA
                myCoursesSection.style.display = 'none';
                myCoursesButton.textContent = 'Mostrar Meus Acessos';
            } else {
                // Se estiver oculta, MOSTRA e RECARREGA
                // 1. Fechar o modal do Catálogo, se estiver aberto
                if (catalogModal.style.display === 'flex') {
                    catalogModal.style.display = 'none';
                    catalogIframe.src = 'about:blank'; // Limpa o iframe
                }

                // 2. Sempre mostrar a seção Meus Cursos
                myCoursesSection.style.display = 'block';
                myCoursesButton.textContent = 'Ocultar Meus Acessos'; // Altera o texto para "Ocultar"

                // 3. Limpar o display atual antes de recarregar (simula o Limpar Display)
                myCoursesContainer.innerHTML = '<p>Carregando seus recursos em andamento...</p>'; // Mensagem de carregamento
                const resetAllBtn = document.getElementById('resetAllCoursesButton');
                const clearDisplayBtn = document.getElementById('clearMyCoursesDisplayButton');
                if (resetAllBtn) resetAllBtn.remove();
                if (clearDisplayBtn) clearDisplayBtn.remove();

                // 4. Recarregar os cursos do usuário
                fetchAndDisplayMyCourses();

                // O player do curso deve ser escondido se a seção Meus Cursos é aberta
                coursePlayerContainer.style.display = 'none';
                const iframe = coursePlayerContainer.querySelector('iframe');
                if (iframe) { iframe.remove(); }
            }
        });

        // Listener delegado para cliques nos itens de curso
        myCoursesContainer.addEventListener('click', (event) => {
            const courseItem = event.target.closest('.course-item');
            if (courseItem && courseItem.dataset.courseId) {
                loadCourseEnvironment(courseItem.dataset.courseId);
            }
        });

        // Listener do botão Fechar Player
        closeCoursePlayerButton.addEventListener('click', () => {
            coursePlayerContainer.style.display = 'none';
            // Remove apenas o iframe, se existir, para parar a execução
            const iframe = coursePlayerContainer.querySelector('iframe');
            if (iframe) {
                iframe.remove();
            }
            // ADICIONADO: Reabrir o modal do Catálogo e enviar mensagem para abrir sidebar no mobile
            catalogModal.style.display = 'flex'; // Reabre o modal do catálogo
            // Enviar mensagem para o iframe abrir o menu (se for mobile) após ele ser reexibido
            // O onload pode não disparar novamente, então enviamos a mensagem diretamente
            if (catalogIframe && catalogIframe.contentWindow) {
                catalogIframe.contentWindow.postMessage({ action: 'openSidebarIfMobile' }, '*');
            }
        });

        // Listener para o Input de Busca de Curso em Trilhas
        trailCourseSearchInput.addEventListener('input', () => {
            const searchTerm = trailCourseSearchInput.value.trim().toLowerCase();

            if (!searchTerm) {
                renderTrails(currentTrailsData); // Mostra todas se busca vazia
                return;
            }

            if (!currentTrailsData || currentTrailsData.length === 0) {
                renderTrails([]); // Não há dados para filtrar
                return;
            }

            const filteredTrails = currentTrailsData.filter(trail => {
                // Verifica se a trilha tem cursos e se algum curso corresponde
                return trail.trail_courses && trail.trail_courses.some(course => 
                    course.course_title && course.course_title.toLowerCase().includes(searchTerm)
                );
            });

            renderTrails(filteredTrails);
        });

        // Listener do botão Importar JSON de Trilha
        importTrailJsonButton.addEventListener('click', () => importTrailJsonInput.click());
        importTrailJsonInput.addEventListener('change', async (e) => {
            const file = e.target.files[0];
            if (!file) return;
            try {
                const text = await file.text();
                const payload = JSON.parse(text);
                if (!payload.courses || !Array.isArray(payload.courses)) {
                    alert('JSON inválido: sem campo courses');
                    return;
                }
                // Preenche formulário de criação de trilha
                newTrailTitleInput.value = payload.name || '';
                newTrailCoursesInput.value = payload.courses.map(c => c.course_id).join(',');
                createTrailFormContainer.style.display = 'block';
                createTrailFormContainer.scrollIntoView({ behavior: 'smooth', block: 'center' });
            } catch (err) {
                alert('Falha ao ler JSON: ' + err.message);
            } finally {
                importTrailJsonInput.value = '';
            }
        });

        // ADICIONADO: Listener delegado para o botão "Zerar Todos"
        myCoursesContainer.addEventListener('click', async (event) => {
            if (event.target.id === 'resetAllCoursesButton') {
                if (confirm('Tem certeza que deseja zerar o progresso de TODOS os seus recursos?')) {
                    const allCourses = Array.from(myCoursesContainer.querySelectorAll('.course-item'));
                    for (const courseItem of allCourses) {
                        const courseId = courseItem.dataset.courseId;
                        if (courseId) {
                            await resetCourse(courseId, 'Zerar'); // Chama para cada curso
                        }
                    }
                    alert('Todos os recursos foram zerados (ou tentativa de zerar realizada).');
                    fetchAndDisplayMyCourses(); // Recarrega a lista após zerar
                }
            } else if (event.target.classList.contains('reset-course-button')) {
                const courseId = event.target.dataset.courseId;
                if (courseId && confirm(`Tem certeza que deseja zerar o progresso deste recurso (ID: ${courseId})?`)) {
                    await resetCourse(courseId, 'Zerar');
                    alert('Recurso zerado (ou tentativa de zerar realizada).');
                    fetchAndDisplayMyCourses(); // Recarrega a lista após zerar um único curso
                }
            } else if (event.target.classList.contains('hide-course-button')) { // NOVO: Listener para Ocultar (Display Only)
                const courseItem = event.target.closest('.course-item');
                if (courseItem) {
                    if (confirm('Tem certeza que deseja OCULTAR este recurso da lista (apenas display)?')) {
                        courseItem.remove(); // Remove o elemento do DOM
                        alert('Recurso ocultado da exibição.');
                    }
                }
            } else if (event.target.id === 'clearMyCoursesDisplayButton') { // NOVO: Listener para Limpar Display Total
                if (confirm('Tem certeza que deseja LIMPAR TODOS os recursos da exibição (apenas display)?')) {
                    myCoursesContainer.querySelector('ul').innerHTML = '<p>Exibição limpa. Recarregue a página para ver os cursos novamente.</p>'; // Limpa a lista
                    // Também pode remover os botões de controle para evitar cliques em lista vazia
                    const resetAllBtn = document.getElementById('resetAllCoursesButton');
                    const clearDisplayBtn = document.getElementById('clearMyCoursesDisplayButton');
                    if (resetAllBtn) resetAllBtn.remove();
                    if (clearDisplayBtn) clearDisplayBtn.remove();
                    alert('Todos os recursos foram removidos da exibição.');
                }
            }
        });

        // NOVO: Listener para o botão Assistentes de IA
        assistentesAdminButton.addEventListener('click', () => {
            if (loggedInUserApiToken && loggedInUserId) {
                const assistentesUrl = 'https://sobralfreenat.github.io/chat_rosio_livia_geriah/';
                const iframeSrc = `${assistentesUrl}?userToken=${encodeURIComponent(loggedInUserApiToken)}&userId=${encodeURIComponent(loggedInUserId)}&embedded=true&origin=${encodeURIComponent(window.location.origin)}`;
                catalogIframe.src = iframeSrc;
                catalogModal.style.display = 'flex'; // Usa flex para centralizar
            } else {
                alert('Por favor, faça login para acessar os Assistentes de IA.');
            }
        });

    } else {
        console.error('Erro: Não foi possível encontrar um ou mais elementos necessários (formulário/admin/trilhas/criação/ebooks/refresh/gearIcon/myCourses/coursePlayer/closeButton/trailCourseSearchInput/trailSearchContainer/instanceIdInput/loginWithInstanceIdButton/importTrailJsonButton/importTrailJsonInput).');
    }

    // --- Lógica para o Modal do Catálogo ---
    if (exploreCatalogBtn && catalogModal && catalogIframe && closeCatalogModalButton) {
        exploreCatalogBtn.addEventListener('click', function() {
            if (loggedInUserApiToken && loggedInUserId) {
                const catalogBaseUrl = 'https://sobralfreenat.github.io/fnw_curadoria_sie/'; // Sua URL
                // Adiciona parâmetros para o iframe
                const iframeSrc = `${catalogBaseUrl}?userToken=${encodeURIComponent(loggedInUserApiToken)}&userId=${encodeURIComponent(loggedInUserId)}&embedded=true&origin=${encodeURIComponent(window.location.origin)}`;
                catalogIframe.src = iframeSrc;
                catalogModal.style.display = 'flex'; // Usa flex para centralizar (definido no inline style do modal)
                // ADICIONADO: Enviar mensagem para o iframe abrir o menu (se for mobile)
                catalogIframe.onload = () => {
                    catalogIframe.contentWindow.postMessage({ action: 'openSidebarIfMobile' }, '*');
                };
            } else {
                alert('Por favor, faça login para explorar o catálogo.');
            }
        });

        closeCatalogModalButton.addEventListener('click', function() {
            catalogModal.style.display = 'none';
            catalogIframe.src = 'about:blank'; // Limpa o iframe ao fechar
        });
    } else {
        console.error('Elementos do modal do catálogo não encontrados!');
    }

    // Listener para mensagens do iframe
    window.addEventListener('message', function(event) {
        // Opcional: verificar event.origin por segurança se a URL do catálogo for de outro domínio
        // if (event.origin !== 'URL_ESPERADA_DO_CATALOGO') return;

        if (event.data && event.data.action) {
            if (event.data.action === 'acessarItem') {
                console.log('Ação recebida do iframe: acessarItem', event.data.itemId);
                if (event.data.itemId) {
                    loadCourseEnvironment(event.data.itemId); // Sua função existente
                    catalogModal.style.display = 'none'; // Fecha o modal do catálogo
                    catalogIframe.src = 'about:blank';
                }
            } else if (event.data.action === 'finalizarTrilha') {
                console.log('Ação recebida do iframe: finalizarTrilha', event.data.trilhaData);
                catalogModal.style.display = 'none'; // Fecha o modal do catálogo
                catalogIframe.src = 'about:blank';
                // Aqui você pegaria event.data.trilhaData e continuaria o processo:
                // 1. Prompt para nome e email (como era feito na página de curadoria)
                // 2. Geração e download do JSON
                alert('Funcionalidade de finalizar trilha e gerar JSON a ser implementada aqui na página principal.');
                // Exemplo de como pegar os dados:
                // const { name, email, courses } = event.data.trilhaData; // Supondo que trilhaData tenha essa estrutura
            }
        }
    }, false);
    // --- Fim Lógica Modal Catálogo ---

    initKeycloak();

    // Adicionar event listeners para os outros botões de seção se eles já não os têm para usar showSection
    // Exemplo:
    // document.getElementById('myCoursesButton').addEventListener('click', function() {
    //     showSection('myCoursesSection');
    // });
    // document.getElementById('adminButton').addEventListener('click', function() {
    //     showSection('adminSection');
    // });

});

function showSection(sectionId) {
    const sections = ['catalogSection', 'myCoursesSection', 'adminSection']; // Adicione outros IDs de seção aqui
    sections.forEach(id => {
        const section = document.getElementById(id);
        if (section) {
            section.style.display = (id === sectionId) ? 'block' : 'none';
        }
    });
}

// ADICIONADO: Função para zerar ou cancelar um curso
async function resetCourse(courseId, actionType = 'Zerar', comment = '') {
    console.log(`[resetCourse] Iniciando ${actionType} para o curso ID: ${courseId}`);

    if (!loggedInUserId || !loggedInUserToken || !loggedInUserApiToken) {
        alert('Erro: Usuário não logado ou informações incompletas para zerar/cancelar curso.');
        console.error('[resetCourse] Usuário não logado ou informações incompletas.');
        return false;
    }

    const formData = new FormData();
    formData.append('token', loggedInUserApiToken);
    formData.append('user_id', loggedInUserId);
    formData.append('user_token', loggedInUserToken);
    formData.append('course_id', courseId);
    
    // Define a ação com base no tipo
    if (actionType === 'Zerar') {
        formData.append('action', '1'); // 1 para zerar
    } else if (actionType === 'Cancelar') {
        formData.append('action', '2'); // 2 para cancelar
        if (comment) {
            formData.append('comment', comment);
        } else {
            alert('Comentário é obrigatório para cancelar um curso.');
            return false;
        }
    } else {
        console.error('[resetCourse] Tipo de ação inválido:', actionType);
        return false;
    }

    try {
        const response = await fetch(setResetCourseApiUrl, {
            method: 'POST',
            body: formData
        });
        if (!response.ok) {
            const errorText = await response.text();
            throw new Error(`Erro HTTP: ${response.status} - ${errorText}`);
        }
        const result = await response.json();

        if (result.SUCCESS) {
            console.log(`[resetCourse] ${actionType} bem-sucedido para o curso ID ${courseId}: ${result.SUCCESS}`);
            return true;
        } else if (result.ERROR) {
            console.error(`[resetCourse] Erro na API ao ${actionType.toLowerCase()} o curso ID ${courseId}: ${result.ERROR}`);
            alert(`Erro ao ${actionType.toLowerCase()} o curso: ${result.ERROR}`);
            return false;
        } else {
            console.error(`[resetCourse] Resposta inesperada da API set-reset para o curso ID ${courseId}:`, result);
            alert(`Erro inesperado ao ${actionType.toLowerCase()} o curso.`);
            return false;
        }
    } catch (error) {
        console.error(`[resetCourse] Falha na comunicação com a API ao ${actionType.toLowerCase()} o curso ID ${courseId}:`, error);
        alert(`Falha ao conectar com a API para ${actionType.toLowerCase()} o curso: ${error.message}`);
        return false;
    }
}

</script>

<!-- Modal para o Catálogo/Curadoria via Iframe -->
<div id="catalogModal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background-color:rgba(0,0,0,0.5); z-index:20000; align-items:center; justify-content:center; padding-top: 70px;">
    <button id="closeCatalogModalButton" style="position:absolute; top:10px; right:10px; padding:5px 10px; font-size:1.2em; background:transparent; border:1px solid white; color:white; border-radius:4px; z-index:20001;">&times;</button>
    <!-- Main content container of the modal -->
    <div style="background-color: #3B204A; /* Cor de fundo similar ao tema */ width:100% !important; height:calc(100% - 70px); border-radius:8px; box-shadow:0 5px 15px rgba(0,0,0,0.3); display:flex; flex-direction:column;">
        <iframe id="catalogIframe" style="width:100%; height:100%; border:none; border-radius:0 0 8px 8px; flex-grow: 1;"></iframe>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Set placeholder color for specific input fields
        const emailInput = document.getElementById('email_id');
        const passwordInput = document.getElementById('senha_id');

        if (emailInput) {
            emailInput.setAttribute('placeholder', 'E-mail ou CPF');
            emailInput.style.setProperty('--placeholder-color', 'gray');
            emailInput.style.color = 'initial'; // Ensure main text color is not overriding
        }
        if (passwordInput) {
            passwordInput.setAttribute('placeholder', 'Senha');
            passwordInput.style.setProperty('--placeholder-color', 'gray');
            passwordInput.style.color = 'initial'; // Ensure main text color is not overriding
        }

        // The rest of your existing JavaScript code
        const loginForm = document.getElementById('frmLogin');
        // ... existing JavaScript code ...
    });
</script>

</body>
</html> 
